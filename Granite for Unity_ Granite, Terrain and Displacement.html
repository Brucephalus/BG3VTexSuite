<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><base href="https://documentation.graphinesoftware.com/doc/GraniteUnity/latest/terrain_displacement.html"><style>body{margin-left:0;margin-right:0;margin-top:0}#bN015htcoyT__google-cache-hdr{background:#f8f9fa;font:13px arial,sans-serif;text-align:left;color:#202124;border:0;margin:0;border-bottom:1px solid #dadce0;line-height:16px;padding:16px 28px 24px 28px}#bN015htcoyT__google-cache-hdr *{display:inline;font:inherit;text-align:inherit;color:inherit;line-height:inherit;background:none;border:0;margin:0;padding:0;letter-spacing:0}#bN015htcoyT__google-cache-hdr a{text-decoration:none;color:#1a0dab;}#bN015htcoyT__google-cache-hdr a:hover{text-decoration:underline}#bN015htcoyT__google-cache-hdr a:visited{color:#681da8}#bN015htcoyT__google-cache-hdr div{display:block;margin-top:4px}#bN015htcoyT__google-cache-hdr b{font-weight:bold;display:inline-block;direction:ltr}</style><div id="bN015htcoyT__google-cache-hdr"><div><span>This is Google's cache of <a href="https://documentation.graphinesoftware.com/doc/GraniteUnity/latest/terrain_displacement.html">https://documentation.graphinesoftware.com/doc/GraniteUnity/latest/terrain_displacement.html</a>.</span>&nbsp;<span>It is a snapshot of the page as it appeared on Dec 23, 2022 06:53:19 GMT.</span>&nbsp;<span>The <a href="https://documentation.graphinesoftware.com/doc/GraniteUnity/latest/terrain_displacement.html">current page</a> could have changed in the meantime.</span>&nbsp;<a href="http://support.google.com/websearch/bin/answer.py?hl=en&amp;p=cached&amp;answer=1687222"><span>Learn more</span>.</a></div><div><span style="display:inline-block;margin-top:8px;margin-right:104px;white-space:nowrap"><span style="margin-right:28px"><span style="font-weight:bold">Full version</span></span><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:https://documentation.graphinesoftware.com/doc/GraniteUnity/latest/terrain_displacement.html&amp;strip=1&amp;vwsrc=0"><span>Text-only version</span></a></span><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:https://documentation.graphinesoftware.com/doc/GraniteUnity/latest/terrain_displacement.html&amp;strip=0&amp;vwsrc=1"><span>View source</span></a></span></span></div><span style="display:inline-block;margin-top:8px;color:#70757a"><span>Tip: To quickly find your search term on this page, press <b>Ctrl+F</b> or <b>⌘-F</b> (Mac) and use the find bar.</span></span></div><div style="position:relative;"><!-- HTML header for doxygen 1.8.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<link href='https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
<title>Granite for Unity: Granite, Terrain and Displacement</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="graphine.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="graphine.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td>
   <div id="projectname">Granite for Unity
   &#160;<span id="projectnumber">v2018.2</span>
   </div>
  </td>
  <td>
	<a href="https://support.graphinesoftware.com"> <img src="comments.png"> Get Support</a><br/>
	<a href="/authentication"> <img src="user.png"> Account</a>	
  </td>
<td style="width:300px" ><script>
  (function() {
    var cx = '011508249882445291888:h2p-b6fnveq';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div style="width:300px" >
<gcse:search defaultToRefinement="unity" ></gcse:search></div></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('terrain_displacement.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Granite, Terrain and Displacement </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#terrain_displacement_terrain">Introduction </a></li>
<li class="level1"><a href="#terrain_displacement_displacement_non_streamed">Streaming textures with non-streamed displacement </a></li>
<li class="level1"><a href="#terrain_displacement_displacement_streamed">Streaming displacement </a></li>
</ul>
</div>
<div class="textblock"><p>This page goes over how Granite can be used with the terrain system or materials using displacement.</p>
<h1><a class="anchor" id="terrain_displacement_terrain"></a>
Introduction </h1>
<p>Granite has limited compatibility with the legacy Unity terrain system and requires users to write a custom shader. Important to note is that Granite does not work with the splatmap system used by the stock unity terrain shaders. Instead you should put the textures for your entire terrain in a Granite Tileset.</p>
<div class="image">
<img src="terrain_displacement_color.png" alt="terrain_displacement_color.png"/>
<div class="caption">
Terrain color map streamed by Granite</div></div>
<p> Limits:</p><ul>
<li>Texture painting does not work.</li>
<li>After <b>Terrainsettings : Base Map Distance</b> distance, the terrain will fall back to a legacy non-Granite diffuse shader using a low res version of the used color texture. This change can be quite noticeable and is hard coded into the terrain system. Most users will want to set this distance to maximum.   </li>
</ul>
<h1><a class="anchor" id="terrain_displacement_displacement_non_streamed"></a>
Streaming textures with non-streamed displacement </h1>
<p>Users can stream textures on top of displaced meshes by converting a displacement shader with the usual shader conversion methods detailed <a class="el" href="converting_shaders.html">here</a>. Keep in mind that Granite will stream based on the undisplaced mesh. In the case of a terrain-like displacement, textures on the back of a hill are still streamed in because Granite generates its visibility information based on the original undisplaced plane mesh.</p>
<div class="image">
<img src="terrain_displacement_mesh.png" alt="terrain_displacement_mesh.png"/>
<div class="caption">
Displaced plane mesh with textures streamed by Granite</div></div>
 <h1><a class="anchor" id="terrain_displacement_displacement_streamed"></a>
Streaming displacement </h1>
<p>The streaming of displacement maps using Granite is possible with a different sampling workflow. It requires a second Granite sample in the vertex shader. The following shader will offset the mesh vertices based on a streamed displacement map. Note that this dispacement sampling is not limited to terrain but works with arbitrary displacment mapping shaders including tesselation domain shaders.</p>
<p>Below is a simple sample shader that does displacements in the vertex shader:</p>
<div class="fragment"><div class="line">﻿Shader &quot;Granite/GraniteDisplacement&quot; {</div><div class="line">    Properties {</div><div class="line">        _MaintTex (&quot;Color Texture&quot;, 2D) = &quot;white&quot; {}</div><div class="line">        _Color (&quot;Color&quot;, color) = (1,1,1,0)</div><div class="line">        _DispTex (&quot;Disp Texture&quot;, 2D) = &quot;gray&quot; {}</div><div class="line">        _Displacement (&quot;Displacement&quot;, Range(0, 10.0)) = 0.3</div><div class="line">        _DispOffset (&quot;Disp Offset&quot;, Range(0, 1)) = 0.5</div><div class="line"></div><div class="line">        // Granite</div><div class="line">        [HideInInspector]_GrIndex(&quot;GraniteIndex&quot;, Vector) = (-1.0, 0.0, 0.0, 0.0)</div><div class="line">        [HideInInspector]_GrSTCB(&quot;Granite_stcb&quot;, Vector) = (0.0, 0.0, 1.0, 1.0)</div><div class="line">        [HideInInspector]_GrSTCB2(&quot;Granite_stcb2&quot;, Vector) = (10.0, 0.0, 1.0, 1.0)</div><div class="line">    }</div><div class="line">    SubShader {</div><div class="line">        Tags { &quot;RenderType&quot;=&quot;Opaque&quot;  &quot;Granite&quot; = &quot;True&quot; }</div><div class="line"></div><div class="line">        Pass {</div><div class="line">            Name &quot;FORWARD&quot;</div><div class="line">            Tags { &quot;Granite&quot;=&quot;True&quot;}</div><div class="line"></div><div class="line">            CGPROGRAM</div><div class="line">            #pragma vertex Vert</div><div class="line">            #pragma fragment Frag</div><div class="line">            // Granite</div><div class="line">            #include &quot;Assets/GraniteSDK/Shaders/GraniteUnity.cginc&quot;</div><div class="line"></div><div class="line">            #pragma target 5.0 //or higher</div><div class="line">            #pragma exclude_renderers gles psp2 d3d9</div><div class="line">            // Granite</div><div class="line">            #pragma shader_feature GRANITE_VALID</div><div class="line">            #pragma shader_feature GRANITE_GTS_0 GRANITE_GTS_1 GRANITE_GTS_2 GRANITE_GTS_3 GRANITE_GTS_4 GRANITE_GTS_5 GRANITE_GTS_6 GRANITE_GTS_7</div><div class="line">            #pragma multi_compile __ GRANITE_RW_RESOLVE</div><div class="line"></div><div class="line">            float _Displacement;</div><div class="line">            float _DispOffset;</div><div class="line">            sampler2D _MainTex;</div><div class="line">            float4 _Color;</div><div class="line">            sampler2D _DispTex;</div><div class="line">            uniform float4 _DispTex_ST;</div><div class="line">            // Granite</div><div class="line">            DeclareGraniteLayer(0, _MainTex)</div><div class="line">            DeclareGraniteLayerLOD(1, _DispTex)</div><div class="line"></div><div class="line">            struct appdata</div><div class="line">            {</div><div class="line">                 float4 vertex : POSITION;</div><div class="line">                 float4 tex : TEXCOORD0;</div><div class="line">                 float3 normal : NORMAL;</div><div class="line">            };</div><div class="line"></div><div class="line">            struct VertexOutput</div><div class="line">            {</div><div class="line">                    UNITY_POSITION(pos);</div><div class="line">                    float2 tex                            : TEXCOORD0;</div><div class="line">            };</div><div class="line"></div><div class="line">            VertexOutput Vert(appdata v)</div><div class="line">            {</div><div class="line">                    VertexOutput o;</div><div class="line">                    UnityLODLookupData data = SampleGraniteLayers(float2(v.tex.xy * _DispTex_ST.xy + _DispTex_ST.zw), 0);</div><div class="line"></div><div class="line">                    float d = ExtractGraniteLayerLOD_DispTex(data).r * _Displacement;</div><div class="line">                    d = d * 0.5 - 0.5 + _DispOffset;</div><div class="line">                    o.pos = UnityObjectToClipPos(v.vertex + float4(v.normal.xyz, 0.0f) * d);</div><div class="line">                    o.tex = v.tex;</div><div class="line">                    return o;</div><div class="line">            }</div><div class="line"></div><div class="line">            GRANITE_PIXELSHADER_ATTRIBUTES</div><div class="line">            float4 Frag (VertexOutput IN) : SV_Target</div><div class="line">            {</div><div class="line">                    UnityLookupData data = SampleGraniteLayers(IN.tex);</div><div class="line">                    GraniteWriteResolveOutput(data, IN.pos);</div><div class="line"></div><div class="line">                    return ExtractGraniteLayer_MainTex(data) * _Color;</div><div class="line">            }</div><div class="line">            ENDCG</div><div class="line">        }</div><div class="line">    }</div><div class="line">    FallBack off</div><div class="line">}</div></div><!-- fragment --><ul>
<li>DeclareGraniteLayerLOD is used to enable a layer to also be sampled with an explicit mip level. We use 0 as that will always let us sample from the highest resolution mip level currently streamed in. Note we can safely do this because granite will not stream in any data based on access in the vertex shader. <em>Do Not</em> do a fixed sample of sample level 0 in the pixel shader as this will cause the full resolution of all textures to be streamed in negating any benefits from Granite mipmap streaming.</li>
<li>UnityLODLookupData is returned from a SampleGraniteLayers that passes a desired LOD level as a second parameter.</li>
<li>ExtractGraniteLayerLOD_DispTex is used to extract the data from the explicit LOD sample. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
		Confidential - Copyright 2012-2018 Graphine NV - Part of this Software is covered by pending patents. - <a href="software_licenses.html">Third Party Software Licenses</a></li>
  </ul>
</div>
</body>
</html>
